"use strict";var ejpAlerts=ejpAlerts||{};ejpAlerts.errors=ejpAlerts.errors||{},ejpAlerts.alertType={etoc:"etoc",pap:"pap"},ejpAlerts.errors.email={invalid:"This is not a valid email address, please try again."},Object.freeze(ejpAlerts.alertType),Object.freeze(ejpAlerts.errors.email),ejpAlerts.isEmailValid=function(e){return/^(([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5}){1,25})$/.test(e)},ejpAlerts.isValidAlertType=function(e){return e&&ejpAlerts.alertType.hasOwnProperty(e.toLowerCase())},ejpAlerts.subscribeToAlert=function(e,t,r,s,i){if(e&&!ejpAlerts.isEmailValid(e))s(ejpAlerts.errors.email.invalid);else if(ejpAlerts.isValidAlertType(t)){var a=_spPageContextInfo.siteAbsoluteUrl+"/_layouts/OAKS.Journals/AlertsSubscribionService.svc/SubscribeToAlert",n="An error occured while subscribing to the alert.",l={data:{}};e&&(l.data.email=e),i&&(l.data.setContextUrlAsDefaultPage=i),l.data.alertType=t,$.ajax({type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(l),url:a,success:function(e){if(2===e.status)return console.error("An error occured while subscribing to "+t+"."),void s(e.message);r()},error:function(e,t,r){console.error(n),s(n)}})}else s("Alert Type is invalid.")},window.addEventListener("DOMContentLoaded",function(){var c=document.querySelectorAll(".js-section-alert");if(c)for(var e=function(e){function a(){t.textContent=i,s.classList.contains("dn")||s.classList.add("dn")}function n(e){s.textContent=e,s.classList.contains("dn")&&s.classList.remove("dn")}var l=c[e],t=l.querySelector(".js-section-alert__content"),r=l.querySelector(".js-section-alert__subscribe-button"),s=l.querySelector(".js-section-alert--error"),o=r.getAttribute("data-alert-type"),i=r.getAttribute("data-subscribed-msg");r.addEventListener("click",function(e){var t=l.querySelector(".js-section-alert__email"),r=!0,s=null;if(t&&(s=t.value,ejpAlerts.isEmailValid(s)||(r=!1,n(ejpAlerts.errors.email.invalid))),r){var i=!!s;ejpAlerts.subscribeToAlert(s,o,a,n,i)}e.stopPropagation(),e.preventDefault()})},t=0;t<c.length;t++)e(t)}),function(a){a(function(){a(".js-subscribe-to-alerts-container").each(function(e,t){var i=a(t);i.find(".js-subscribe-to-alerts-btn").on("click",function(e){var t=a(e.target),r=t.data("alert-type"),s=t.data("subscribed-msg");_spPageContextInfo.siteAbsoluteUrl;ejpAlerts.subscribeToAlert(null,r,function(){t.hide(),i.find(".js-subscribe-to-alerts-body-text").text(s)},function(e){console.error("Exception occurs during subscribing to "+r+".")}),e.preventDefault(),e.stopPropagation()})})})}(jQuery);
"use strict";function LoginFormField(e,i,a){function s(e){if(null!=r.error&&e){r.error.html(""),r.error.removeClass("dn");var i=$("<div>").html(e).text();r.error.append(i)}}var r=this;this.container=e,this.control=i,this.error=a,this.validators=[],this.isValid=!1,this.validate=function(e,i){i=i||!1;for(var a in r.container.removeClass("notValid").removeClass("valid"),r.validators){var t=r.validators[a].validate();if(t&&!t.isValid)return r.isValid=!1,void(e||(r.container.addClass("notValid"),s(t.errorMessage)))}r.isValid=!0,i||r.container.addClass("valid"),null!=r.error&&(r.error.html(""),r.error.addClass("dn"))},this.showValidationStatus=function(e){r.container.removeClass("notValid").removeClass("valid"),r.isValid?r.container.addClass("valid"):r.container.addClass("notValid"),s(e)},this.applyValidationResult=function(e){r.isValid=e.isValid,r.showValidationStatus(e.errorMessage)},this.showInfoMessage=function(e){r.container.removeClass("notValid").removeClass("valid"),s(e)},this.highlightErrorField=function(){r.container.addClass("notValid").removeClass("valid")}}var userLoginValidation=null;function UserLoginFormBase(t){userLoginValidation=new UserLoginValidation(t.validationServiceEndpoint,t.passwordHttpRequestHeaderKey);function s(){t.errorMessageContainer.find("[data-validation-result]").hide(),t.errorMessageContainer.hide()}s();function r(){if(!userLoginValidation)return!0;var e=!0;for(var i in t.formFields)if(!userLoginValidation.isFieldSelectedOrCheckedOrNotEmpty(t.formFields[i])){e=!1;break}return e}function o(e){s(),e.isValid||(t.formFields.password.control.val(""),t.formFields.password.highlightErrorField(),t.formFields.password.control.focus(),function(e){if(e){var i=t.errorMessageContainer.find("[data-validation-result='"+e+"']");i.length||(i=t.errorMessageContainer.find("[data-validation-result='']")).first().text(e),i.show(),t.errorMessageContainer.show()}}(e.errorMessage),disableSubmitButtonOnError(e,t))}var i=this;i.messages={userNameReqired:"&lt;span class=&#39; red i b db mb3 &#39;&gt;User name is required.&lt;/span&gt;",passwordRequired:"&lt;span class=&#39; red i b db mb3&#39;&gt;Password is required.&lt;/span&gt;"},i.updateSubmitButtonAvailability=function(){if(!r())return t.submitButton.hasClass("disabled")||t.submitButton.addClass("disabled"),void t.submitButton.removeClass("active");var e=!0;for(var i in t.formFields)t.formFields[i].isValid||(e=!1);e?(t.submitButton.hasClass("active")||t.submitButton.addClass("active"),t.submitButton.removeClass("disabled")):(t.submitButton.hasClass("disabled")||t.submitButton.addClass("disabled"),t.submitButton.removeClass("active"))},i.validateField=function(e){e.validate(),i.updateSubmitButtonAvailability()},t.errorMessageContainer.find("[aria-label='close dialog']").on("click",function(){clearPostLoginAction(),s()}),t.submitButton.on("click",function(e){if(!r())return t.submitButton.hasClass("disabled")||t.submitButton.addClass("disabled"),t.submitButton.removeClass("active"),e.preventDefault(),e.stopPropagation(),!1;if(!userLoginValidation.isAccountValid(t.formFields.userName.control.val(),t.formFields.password.control.val(),t.journalShortName,o))return e.preventDefault(),e.stopPropagation(),!1;var i=!0;for(var a in t.formFields)t.formFields[a].showValidationStatus(),t.formFields[a].isValid||(i=!1);return i?(s(),t.submitButton.addClass("disabled"),t.submitButton.unbind("click"),t.submitButton.on("click",function(e){e.preventDefault(),e.stopPropagation()}),!0):(e.preventDefault(),e.stopPropagation(),!1)})}function UserLoginForm(i){var e=new UserLoginFormBase(i);userLoginValidation&&(i.formFields.userName.validators.push(new RequiredFieldValidator(i.formFields.userName,e.messages.userNameReqired)),i.formFields.userName.control.on("keyup change blur input",function(){e.validateField(i.formFields.userName)}),i.formFields.password.validators.push(new RequiredFieldValidator(i.formFields.password,e.messages.passwordRequired)),i.formFields.password.control.on("keyup blur input",function(){e.validateField(i.formFields.password)}),i.formFields.password.control.on("change",function(){e.validateField(i.formFields.password),""!==i.formFields.password.control.value&&e.validateField(i.formFields.userName)})),this.init=function(){for(var e in i.type,i.submitButton.addClass("disabled"),i.formFields){i.formFields[e].validate(!0)}i.errorMessageContainer.hide()}}function disableSubmitButtonOnError(e,i){e.isValid||i.submitButton.hasClass("disabled")||i.submitButton.addClass("disabled")}function ValidationResult(e,i){return{isValid:e,errorMessage:i}}function RequiredFieldValidator(e,i){var a=this;this.field=e,this.errorMessage=i,this.validate=function(){var e=a.field.control.prop("tagName").toLowerCase();if("input"!==e)return"select"!==e?new ValidationResult(!0):new ValidationResult("-1"!==a.field.container.find(":selected").val(),a.errorMessage);var i=a.field.control.attr("type");return"checkbox"===i?new ValidationResult(a.field.control.is(":checked")):("text"===i||"email"===i||"password"===i)&&""===a.field.control.val().trim()?new ValidationResult(!1,a.errorMessage):new ValidationResult(!0)}}function UserLoginValidation(e,i){var o=e,n=i;return{isAccountValid:function(e,i,a,t){return function(e,i,a,t){var s=o+"/IsAccountValid?userName="+encodeURIComponent(e)+"&journalShortName="+encodeURIComponent(a),r=!1;return $.ajax({url:s,type:"GET",async:!1,dataType:"json",success:function(e){r=e?(t(new ValidationResult(e.IsValid,e.ErrorMessage)),e.IsValid):(t(new ValidationResult(!1,"The service is irresponsible, please try again later.")),!1)},error:function(e,i,a){t(new ValidationResult(!1,"The service is irresponsible, please try again later.")),console.error("The service is irresponsible. Status: "+i+". Error: "+a),r=!1},beforeSend:function(e){e.setRequestHeader(n,i)}}),r}(e,i,a,t)},isFieldSelectedOrCheckedOrNotEmpty:function(e){return function(e){var i=e.control.prop("tagName").toLowerCase();if("input"!==i)return"select"!==i||"-1"!==e.container.find(":selected").val();var a=e.control.attr("type");return"checkbox"===a?e.control.is(":checked"):"text"!==a&&"email"!==a&&"password"!==a||""!==e.control.val().trim()}(e)}}}